<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>引継ぎくん - 業務引継ぎ支援AI</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <!-- htmx -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10/dist/ext/sse.js"></script>
    <!-- marked.js for markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- ヘッダー -->
        <header class="header">
            <a href="/" class="back-link">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
                <span>ホーム</span>
            </a>
        </header>

        <!-- ステップインジケーター -->
        <div class="step-indicator" id="step-indicator">
            <div class="step-dot active" data-step="welcome"></div>
            <div class="step-dot" data-step="upload"></div>
            <div class="step-dot" data-step="uploading"></div>
            <div class="step-dot" data-step="phase1"></div>
            <div class="step-dot" data-step="questions"></div>
            <div class="step-dot" data-step="phase2"></div>
            <div class="step-dot" data-step="complete"></div>
        </div>

        <!-- メインコンテンツ -->
        <main class="main-content">

            <!-- Step: Welcome -->
            <section id="step-welcome" class="step active">
                <div class="welcome-content">
                    <div class="phase-icon gradient">
                        <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"/>
                            <line x1="7" y1="2" x2="7" y2="22"/>
                            <line x1="17" y1="2" x2="17" y2="22"/>
                            <line x1="2" y1="12" x2="22" y2="12"/>
                            <line x1="2" y1="7" x2="7" y2="7"/>
                            <line x1="2" y1="17" x2="7" y2="17"/>
                            <line x1="17" y1="17" x2="22" y2="17"/>
                            <line x1="17" y1="7" x2="22" y2="7"/>
                        </svg>
                    </div>
                    <h1 class="welcome-title">お疲れさまです!<br>あともう少しですね</h1>
                    <p class="welcome-description">
                        業務の録画をポンっとアップロードするだけ。<br>
                        あとは引継ぎくんが全部やっておきます
                    </p>

                    <!-- 処理の説明 -->
                    <div class="process-box">
                        <div class="process-header">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 3l1.45 2.9L17 6.5l-2.18 2.18L15.36 13 12 11.18 8.64 13l.54-4.32L7 6.5l3.55-.6L12 3z"/>
                                <path d="M19 19H5"/>
                            </svg>
                            <h3>どうやって作るの?</h3>
                        </div>
                        <div class="process-steps">
                            <div class="process-step">
                                <div class="step-number primary">1</div>
                                <div class="step-content">
                                    <p class="step-title">まず動画をざっと確認</p>
                                    <p class="step-desc">何の作業かを把握します (約30秒)</p>
                                </div>
                            </div>
                            <div class="process-step">
                                <div class="step-number primary">2</div>
                                <div class="step-content">
                                    <p class="step-title">いくつか質問します</p>
                                    <p class="step-desc">誰に引き継ぐか、など</p>
                                </div>
                            </div>
                            <div class="process-step">
                                <div class="step-number accent">3</div>
                                <div class="step-content">
                                    <p class="step-title">本格的にドキュメント生成</p>
                                    <p class="step-desc">あなたの回答を元に、詳しく解析します</p>
                                </div>
                            </div>
                        </div>
                        <p class="process-note">まず概要を把握してから質問することで、より精度の高いドキュメントを作れます</p>
                    </div>

                    <button type="button" class="btn-primary-large" id="start-upload-btn">
                        <span>動画をアップロード</span>
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M9 18l6-6-6-6"/>
                        </svg>
                    </button>
                    <p class="format-hint">対応形式: MP4, MOV, AVI / 最大500MB</p>
                </div>
            </section>

            <!-- Step: Upload -->
            <section id="step-upload" class="step">
                <div class="upload-content">
                    <h2 class="section-title">録画した動画はありますか?</h2>
                    <p class="section-description">ここに置いてもらえれば、すぐに処理を始めます</p>

                    <div class="upload-area" id="drop-zone">
                        <input type="file" id="file-input" accept="video/*" hidden>
                        <div class="upload-icon" id="upload-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="56" height="56" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="17 8 12 3 7 8"/>
                                <line x1="12" y1="3" x2="12" y2="15"/>
                            </svg>
                        </div>
                        <p class="upload-text" id="upload-text">ファイルをドロップ、またはクリック</p>
                        <p class="upload-hint">MP4, MOV, AVI / 最大500MB</p>
                    </div>

                    <button type="button" class="back-button" id="back-to-welcome">戻る</button>
                </div>
            </section>

            <!-- Step: Uploading -->
            <section id="step-uploading" class="step">
                <div class="uploading-content">
                    <div class="phase-icon gradient pulse">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="17 8 12 3 7 8"/>
                            <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                    </div>
                    <h2 class="section-title">受け取りました!</h2>
                    <p class="section-description">まずは動画の内容を確認させてください</p>

                    <div class="progress-card">
                        <div class="file-info">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"/>
                                <line x1="7" y1="2" x2="7" y2="22"/>
                                <line x1="17" y1="2" x2="17" y2="22"/>
                                <line x1="2" y1="12" x2="22" y2="12"/>
                            </svg>
                            <div class="file-details">
                                <p class="file-name" id="file-name">video.mp4</p>
                                <p class="file-size" id="file-size">0 MB</p>
                            </div>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar" id="upload-progress"></div>
                        </div>
                        <p class="progress-text" id="progress-text">0%</p>
                    </div>
                </div>
            </section>

            <!-- Step: Phase1 (軽量解析) -->
            <section id="step-phase1" class="step">
                <div class="phase1-content">
                    <div class="phase-icon gradient">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                            <circle cx="12" cy="12" r="3"/>
                        </svg>
                    </div>
                    <h2 class="section-title">動画を確認しています</h2>
                    <p class="section-description">何の作業か把握中です...</p>

                    <div class="recognition-card">
                        <div class="recognition-header">
                            <div class="live-indicator">
                                <span class="live-dot"></span>
                                <span>リアルタイム解析中</span>
                            </div>
                            <span class="recognition-progress" id="phase1-progress">0%</span>
                        </div>
                        <div class="progress-bar-container thin">
                            <div class="progress-bar gradient" id="phase1-progress-bar"></div>
                        </div>
                        <div class="current-recognition">
                            <span class="timestamp" id="current-timestamp">00:00</span>
                            <span class="recognition-text" id="current-recognition">解析を開始しています...</span>
                        </div>
                    </div>

                    <p class="phase-hint">もうすぐ終わります。このあと簡単な質問をさせてください</p>
                </div>
            </section>

            <!-- Step: Questions -->
            <section id="step-questions" class="step">
                <div class="questions-content">
                    <!-- 初回のみ表示されるヘッダー -->
                    <div class="questions-header" id="questions-header">
                        <div class="phase-icon accent-gradient">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 3l1.45 2.9L17 6.5l-2.18 2.18L15.36 13 12 11.18 8.64 13l.54-4.32L7 6.5l3.55-.6L12 3z"/>
                                <path d="M19 19H5"/>
                            </svg>
                        </div>
                        <h2 class="section-title">少しだけ教えてください</h2>
                        <p class="section-description">
                            待ち時間を有効活用しましょう!<br>
                            答えてもらうほど、いい感じのドキュメントができます
                        </p>
                    </div>

                    <!-- AIが理解した内容 -->
                    <div class="ai-understanding" id="ai-understanding">
                        <div class="understanding-header">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                <polyline points="22 4 12 14.01 9 11.01"/>
                            </svg>
                            <h3>ここまで分かりました</h3>
                        </div>
                        <div class="understanding-items">
                            <div class="understanding-item">
                                <span class="item-label">作業内容:</span>
                                <span class="item-value" id="ai-task-type">顧客管理システムへのデータ入力</span>
                            </div>
                            <div class="understanding-item">
                                <span class="item-label">推定ステップ:</span>
                                <span class="item-value" id="ai-estimated-steps">約7個</span>
                            </div>
                            <div class="understanding-item">
                                <span class="item-label">使用ツール:</span>
                                <span class="item-value" id="ai-tools">Chrome、Excel、社内システム</span>
                            </div>
                            <div class="understanding-item">
                                <span class="item-label">所要時間:</span>
                                <span class="item-value" id="ai-duration">約15分</span>
                            </div>
                        </div>
                    </div>

                    <!-- チャットメッセージ -->
                    <div class="chat-messages" id="chat-messages">
                        <!-- 会話履歴がここに追加される -->
                    </div>

                    <!-- 現在の質問 -->
                    <div class="current-question" id="current-question">
                        <div class="ai-message">
                            <div class="ai-avatar pulse">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M12 3l1.45 2.9L17 6.5l-2.18 2.18L15.36 13 12 11.18 8.64 13l.54-4.32L7 6.5l3.55-.6L12 3z"/>
                                </svg>
                            </div>
                            <p class="ai-question-text" id="question-text">誰に引き継ぎますか?</p>
                        </div>

                        <!-- テキスト入力 -->
                        <div class="question-input-area" id="text-input-area">
                            <input type="text" class="question-input" id="question-input" placeholder="入力してEnter">
                            <button type="button" class="send-button" id="send-btn">
                                <span>送信</span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M9 18l6-6-6-6"/>
                                </svg>
                            </button>
                        </div>

                        <!-- 選択肢 -->
                        <div class="choice-options" id="choice-options" style="display: none;">
                            <!-- 選択肢がここに追加される -->
                        </div>
                    </div>

                    <!-- 質問プログレス -->
                    <div class="question-progress" id="question-progress">
                        <!-- プログレスドットがここに追加される -->
                    </div>
                </div>
            </section>

            <!-- Step: Phase2 (本格解析) -->
            <section id="step-phase2" class="step">
                <div class="phase2-content">
                    <div class="phase-icon gradient pulse">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                        </svg>
                    </div>
                    <h2 class="section-title">ドキュメントを書いています</h2>
                    <p class="section-description">あなたの回答を元に、詳しく解析しています</p>

                    <!-- 3段階プログレス -->
                    <div class="generation-stages">
                        <div class="stage" id="stage-overview">
                            <div class="stage-indicator">
                                <div class="stage-dot"></div>
                            </div>
                            <span class="stage-label">動画の概要把握</span>
                        </div>
                        <div class="stage" id="stage-confirmation">
                            <div class="stage-indicator">
                                <div class="stage-dot"></div>
                            </div>
                            <span class="stage-label">内容の確認</span>
                        </div>
                        <div class="stage" id="stage-generation">
                            <div class="stage-indicator">
                                <div class="stage-dot"></div>
                            </div>
                            <span class="stage-label">詳細なドキュメント生成</span>
                        </div>

                        <div class="progress-bar-container">
                            <div class="progress-bar gradient" id="phase2-progress-bar"></div>
                        </div>
                        <div class="progress-info">
                            <span class="current-task" id="phase2-task">動画全体を分析中...</span>
                            <span class="progress-percent" id="phase2-progress">0%</span>
                        </div>
                    </div>

                    <!-- 生成中のドキュメント -->
                    <div class="generated-steps" id="generated-steps" style="display: none;">
                        <div class="steps-header">
                            <span class="live-dot"></span>
                            <h3>生成中のドキュメント</h3>
                        </div>
                        <div class="steps-list" id="steps-list">
                            <!-- ステップがここに追加される -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Step: Complete -->
            <section id="step-complete" class="step">
                <div class="complete-content">
                    <div class="complete-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="20 6 9 17 4 12"/>
                        </svg>
                    </div>
                    <h2 class="complete-title">できました!お疲れさまでした</h2>
                    <p class="complete-description">
                        引継ぎドキュメントが完成。<br>
                        <span class="accent-text">あとは提出するだけです</span>
                    </p>

                    <!-- 生成されたドキュメント -->
                    <div class="document-preview">
                        <div class="document-header">
                            <h3 id="document-title">顧客管理システムへのデータ入力</h3>
                            <p id="document-duration">推定所要時間: 約15分</p>
                        </div>
                        <div class="document-body">
                            <h4>手順</h4>
                            <div class="document-steps" id="document-steps">
                                <!-- 完成したステップがここに表示される -->
                            </div>
                        </div>
                    </div>

                    <!-- アクション -->
                    <div class="complete-actions">
                        <button type="button" class="btn-primary-large" id="download-btn">
                            ドキュメントをダウンロード
                        </button>
                        <button type="button" class="btn-secondary-large" id="restart-btn">
                            もう一度作成する
                        </button>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <!-- Hidden session ID -->
    <input type="hidden" id="session-id" value="{{ session_id }}">

    <script src="/static/js/app.js"></script>
</body>
</html>
